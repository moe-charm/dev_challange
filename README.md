# ハロウィン街探索 - Halloween Town Explorer

JavaScriptとWeb Audio APIを使用して作成した、3Dレイキャスト技術のハロウィン街探索デモ。DEV.to Frontend Challenge: Halloween Editionへの提出作品。

## 機能

- **3Dレイキャスト技術**を使用した疑似3D環境
- **25x25の広大なマップ**でエリア分け
- **11種類のハロウィンキャラクター**（詳細なスプライト描画）
- **エリアごとに異なる壁の色**（雰囲気の変化）
- **星空と月**のある美しい夜空
- 音効果と環境音
- ミニマップと座標表示
- キーボード操作での移動
- **パフォーマンス最適化**（スプライトキャッシング）

## 操作方法

- **↑↓←→ キー**で移動
- **Sキー**で音のオン/オフ
- **Aキー**で環境音の切り替え
- **画面クリック**で音を有効化

## マップエリア構成（25x25）

1. **左上（幽霊屋敷エリア）** 👻
   - おばけと黒猫が出現
   - 暗い青紫の壁（#2a1a4a）
   - 迷路のような建物配置

2. **右上（魔女の森エリア）** 🧙‍♀️
   - 魔女とコウモリが飛んでいる
   - 深い緑の壁（#1a3a1a）
   - 暗い森のイメージ

3. **中央（街エリア）** 🏘️
   - 魔女っこ（案内役）が待機
   - 建物、ランタン、看板が配置
   - 茶色の壁（#3a1f0f）
   - 比較的開けた道が多い

4. **左下（墓地エリア）** ⚰️
   - 墓石と骸骨が集中
   - 灰色の壁（#4a4a4a）
   - 不気味な雰囲気

5. **下部（かぼちゃ畑エリア）** 🎃
   - かぼちゃがたくさん
   - 暗いオレンジの壁（#5a3010）
   - ランタンで明るめ

## キャラクター一覧

- **0**: 道
- **1**: 建物（エリアごとに色が変化）
- **2**: おばけ 👻（浮遊アニメーション、波打つ裾）
- **3**: かぼちゃ 🎃（パルスアニメーション、光る顔）
- **4**: ランタン 🏮（揺れる、炎の明滅）
- **5**: 看板「BOO!」（支柱付き）
- **6**: 墓石（十字架付き）
- **7**: 魔女 🧹（帽子、ローブ、星の模様、箒）
- **8**: コウモリ 🦇（羽ばたきアニメーション、赤い目）
- **9**: 黒猫 🐱（しっぽの揺れ、まばたき、光る目）
- **10**: 骸骨 💀（カタカタ揺れる、緑の目、肋骨）
- **11**: 魔女っこ 🧙‍♀️（案内役、キラキラエフェクト）

## ファイル構造

```
/
├── index.html          # メインHTMLファイル
├── style.css           # スタイルシート
├── map.js              # マップデータ（25x25、エリア分け）
├── ecs-bitecs.js       # bitECSコンポーネント定義
├── game-bitecs.js      # bitECS版メインゲーム
├── sounds.js           # 音効果管理
├── objects/            # オブジェクトスプライト
│   ├── index.js        # スプライトシステム（キャッシング最適化）
│   ├── ghost.js        # おばけ描画
│   ├── pumpkin.js      # かぼちゃ描画
│   ├── witch.js        # 魔女描画
│   ├── lantern.js      # ランタン描画（詳細版）
│   ├── bat.js          # コウモリ描画
│   ├── cat.js          # 黒猫描画
│   ├── skeleton.js     # 骸骨描画
│   └── witch-girl.js   # 魔女っこ描画（案内役）
├── systems/            # ゲームシステム
│   └── input-bitecs.js # 入力システム
└── README.md           # このファイル
```

## 技術スタック

- 純粋なJavaScript (ES6+)
- HTML5 Canvas（2D描画）
- Web Audio API
- **3Dレイキャスト技術**（Wolfenstein 3D方式）
- **スプライト描画システム**（距離ソート）
- **bitECS** - 超軽量・高速ECSライブラリ (~5KB)
- **パフォーマンス最適化**
  - スプライトキャッシング（初回のみマップ走査）
  - 距離の二乗計算で平方根を遅延
  - 視野角（FOV）による描画範囲制限
- レスポンシブCSS

## 描画システム

### レイキャスティング
- 画面幅分のレイ（光線）を飛ばす
- 建物（type 1）のみ壁として描画
- 魚眼レンズ補正で自然な見た目
- エリアごとに壁の色を変更

### スプライト描画
- キャラクター（type 2-11）は2D スプライトとして描画
- 距離順にソート（遠い→近い）
- 視野角（FOV）内のみ描画
- 距離による明るさ調整

### 天空描画
- グラデーション背景
- 150個の瞬く星
- 月（グロー効果、クレーター付き）

## 実行方法

1. このリポジトリをクローン
2. ローカルHTTPサーバーを起動：
   ```bash
   python3 -m http.server 8000
   ```
3. ブラウザで `http://localhost:8000` にアクセス

## ゲーム化アイデア 🎮

現在は探索デモですが、以下のようなゲーム要素を追加できます：

### 1. 収集ゲーム 🎃
- **目的**: マップ内のすべてのかぼちゃを集める
- **スコア**: 収集したアイテム数 / タイム
- **UI**: 残りアイテム数、タイマー表示
- **実装**: プレイヤーとオブジェクトの距離判定、収集時の効果音

### 2. エリア探索ゲーム 🗺️
- **目的**: 5つのエリアすべてを訪れる
- **システム**: 訪問済みエリアをマーク
- **報酬**: 各エリアで特別なアイテム発見
- **UI**: エリア訪問チェックリスト

### 3. かくれんぼゲーム 👻
- **目的**: 隠れているキャラクターを見つける
- **ヒント**: 魔女っこがヒントをくれる
- **難易度**: 時間制限、キャラクターが移動
- **UI**: 見つけた数 / 総数

### 4. クエストシステム 📜
- **魔女っこからのクエスト**:
  - 「3つのかぼちゃを見つけて！」
  - 「墓地の骸骨を訪ねてみて」
  - 「魔女の森のコウモリを数えて」
- **報酬**: 完了時にメッセージ表示
- **実装**: 会話システム（Eキーで話しかける）

### 5. タイムアタック ⏱️
- **目的**: できるだけ早く全エリア制覇
- **ランキング**: ローカルストレージで記録保存
- **UI**: タイマー、ベストタイム表示

### 6. ホラー要素追加 😱
- **おばけに追いかけられる**: 近づきすぎると逃げる
- **HP/ライフシステム**: 骸骨に触るとダメージ
- **セーフゾーン**: ランタンの近くは安全
- **ゲームオーバー**: 魔女っこの所に戻る

### 7. マルチエンディング 🎬
- **収集率に応じて異なるエンディング**
- **隠しキャラクターを見つけるとボーナス**
- **すべてのエリアを探索するとTrue End**

### 実装が簡単な順番
1. **収集ゲーム** - 距離判定とカウンター表示だけ
2. **エリア探索** - エリア判定とフラグ管理
3. **タイムアタック** - タイマー追加
4. **クエストシステム** - テキスト表示とフラグ管理
5. **かくれんぼ** - 複雑な判定とヒントシステム
6. **ホラー要素** - AI移動、衝突判定、HPシステム

どれから始めたいですかにゃ？

## ライセンス

MIT License
