# Halloween Town Explorer

## プロジェクト概要

JavaScriptとWeb Audio APIを使用した3Dレイキャストのハロウィン街探索ゲーム。DEV.to Frontend Challenge: Halloween Editionへの提出作品。

## 技術スタック

- **言語**: 純粋なJavaScript (ES6+ / ESモジュール)
- **レンダリング**: HTML5 Canvas
- **音響**: Web Audio API
- **技術**: 3Dレイキャスト（Raycasting）
- **ECS**: bitECS - 超軽量・高速ECSライブラリ (~5KB gzipped)
- **スタイル**: レスポンシブCSS

## アーキテクチャ

### Entity-Component-System (ECS) with bitECS

プロジェクトは**bitECS**を使用した高性能ECSアーキテクチャを採用しています：

**bitECSの特徴**:
- データ指向設計（TypedArray使用）
- 超高速（他のECSライブラリーの2-3倍速）
- メモリ効率が最高
- バンドルサイズ ~5KB gzipped
- 依存ゼロ

**ECSの基本構造**:
- **Entity**: ゲーム内のオブジェクトを表すID（プレイヤー、おばけ、かぼちゃなど）
- **Component**: データを保持（位置、回転、速度など）- TypedArrayで高速アクセス
- **System**: ロジックを処理（レンダリング、入力、アニメーションなど）

**コンポーネント**:
- Position: x, y座標
- Rotation: 角度
- Player: 速度、回転速度
- Renderable: 見た目の情報
- Animation: アニメーション情報

**システム**:
- InputSystem: キーボード入力処理、衝突判定
- RenderingSystem: 3Dレイキャストレンダリング
- MinimapSystem: ミニマップ表示
- AnimationSystem: アニメーション更新

### ファイル構成

```
/
├── index.html            # メインHTMLファイル
├── style.css             # スタイルシート（ハロウィンテーマ）
├── map.js                # マップデータ定義
├── ecs.js                # 旧ECSライブラリ（参考用）
├── ecs-bitecs.js         # bitECS コンポーネント定義
├── game-bitecs.js        # bitECS版メインゲームロジック (260行)
├── game.js               # 旧ゲームロジック（参考用）
├── sounds.js             # Web Audio API による音効果管理
├── components/           # コンポーネント定義（旧版）
│   └── objects.js        # オブジェクト関連コンポーネント
├── systems/              # ゲームシステム
│   ├── index.js          # システムのエクスポート（旧版）
│   ├── input-bitecs.js   # bitECS版入力システム (185行)
│   ├── rendering.js      # レンダリングシステム（旧版）
│   ├── input.js          # 入力システム（旧版）
│   ├── minimap.js        # ミニマップシステム（旧版）
│   └── animation.js      # アニメーションシステム（旧版）
└── README.md             # プロジェクト説明
```

**最適化の成果**:
- game.js: 42KB → 9KB (約78%削減)
- 重複コード削除
- bitECS導入による高速化

## 主要機能

### 3Dレイキャスト技術

- 1990年代のゲーム（Wolfenstein 3Dなど）で使われた疑似3D技術
- 各列（スクリーン上の垂直線）に対してレイを飛ばして壁との距離を計算
- 距離に応じて壁の高さを調整して遠近感を表現

### マップシステム

マップは2D配列で定義され、各数値が異なるオブジェクトを表します：

- **0**: 道（通行可能）
- **1**: 建物（通行不可、壁）
- **2**: おばけ（浮遊アニメーション付き）
- **3**: かぼちゃ（ジャック・オ・ランタン）
- **4**: ランタン（光のエフェクト付き）
- **5**: 看板
- **6**: 墓石
- **7**: 魔女（箒を持って浮遊）

### 音響システム

Web Audio APIを使用した音効果：
- 足音（移動時）
- 環境音（ハロウィンの雰囲気を演出）
- 音の有効化/無効化機能
- ブラウザの自動再生ポリシーに対応

### 操作システム

- **矢印キー**: 移動と回転
  - ↑: 前進
  - ↓: 後退
  - ←: 左回転
  - →: 右回転
- **Sキー**: 音のオン/オフ
- **Aキー**: 環境音の切り替え
- **クリック**: 音の有効化

### ミニマップ

- リアルタイムでプレイヤーの位置を表示
- マップの俯瞰図
- 右下に配置

## デザインコンセプト

### カラースキーム

- **背景**: 深い紺色と黒（#0a0e27, #090a0f）
- **アクセント**: オレンジとゴールド（#ff9c00, #ff6d00）
- **ハロウィンカラー**: 紫、オレンジ、黒

### アニメーション

- グローエフェクト（タイトルとランタン）
- フロート効果（おばけ、魔女）
- パルス効果（かぼちゃ）
- フリッカー効果（ランタンの光）

### レスポンシブ対応

- モバイルデバイスでも快適に動作
- ビューポートのサイズに応じてCanvasを自動調整
- タッチデバイスでの操作性を考慮

## 開発メモ

### パフォーマンス考慮事項

- Canvas描画の最適化
- レイキャスト計算の効率化
- 音声ファイルの遅延ロード

### ブラウザ互換性

- モダンブラウザ対応（Chrome, Firefox, Safari, Edge）
- Web Audio APIのブラウザ互換性を考慮
- Canvas 2D APIの標準機能のみ使用

### 今後の改善案

- [ ] より多様なハロウィン要素の追加
- [ ] スプライトベースのキャラクター描画
- [ ] テクスチャマッピング
- [ ] 複数階層のマップ
- [ ] ゲーム要素（アイテム収集など）

## チャレンジ要件への対応

### DEV.to Frontend Challenge: Halloween Edition

**カテゴリ**: Perfect Landing: Halloween

**評価基準**:
- ✅ **アクセシビリティ**: キーボード操作、音の切り替え可能
- ✅ **ユーザビリティ**: 明確な操作説明、ミニマップで位置確認
- ✅ **クリエイティビティ**: 3Dレイキャスト技術の実装
- ✅ **コード品質**: ECSアーキテクチャ、モジュール化

## ライセンス

MIT License
